<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>면허 판매 희망가 등록 서비스</title>
    
    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Pretendard 폰트 로드 (가독성과 세련됨을 위해 선택) -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.min.css" />
    <style>
        /* Pretendard 폰트 설정 및 전체 적용 (Bold 700 사용) */
        body {
            font-family: 'Pretendard', sans-serif;
            font-weight: 700; /* Bold */
        }

        /* 입력 필드 기본 스타일 (Tailwind override) */
        /* 모서리가 둥근 사각형(xl), 높이 증가 (h-14), 글자 크기 증가 (text-xl) */
        .input-field {
            transition: all 0.3s ease;
            @apply border-2 border-transparent focus:border-blue-500 rounded-xl px-4 h-14 text-xl shadow-inner bg-yellow-100;
        }

        /* 입력 완료 (white) 상태 스타일 */
        .input-field.input-completed {
            @apply bg-white shadow-md;
        }

        /* 드롭다운 및 버튼 기본 스타일 */
        select.input-field {
            /* 커스텀 화살표 (하나만 보이도록) */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="%234A7DDA"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>');
            background-repeat: no-repeat;
            background-position: right 1rem center; /* 드롭다운 화살표 위치 */
            background-size: 1.5em;
            @apply appearance-none;
        }

        /* 모달 스타일 */
        .modal {
            @apply fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50;
        }
        .modal-content {
            @apply bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 space-y-4;
        }
        
        /* Tailwind 커스텀 색상 및 설정을 위한 스크립트 */
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#1e40af', /* Dark Blue */
                        'light-blue': '#dbeafe', /* 배경 (하늘색) */
                        'custom-blue-btn': '#4a7dda', /* 메인 버튼 색상 */
                        'grey-btn-text': '#4b5563', /* 회색 버튼 텍스트 색상 */
                    }
                }
            }
        }
    </style>
</head>
<body class="bg-light-blue min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md bg-white rounded-xl shadow-2xl overflow-hidden space-y-4 pb-4">
        <header class="p-6 pb-2"> 
            <!-- 제목 -->
            <h1 class="text-3xl font-bold text-center text-primary-blue mb-2">면허 판매 희망가 등록 서비스</h1>
            
            <!-- 설명 (간격 조정) -->
            <p id="description" class="text-red-600 text-center mb-4 text-lg font-semibold">
                면허금액이 희망가 도달 시, 알려드립니다.
            </p>
        </header>

        <main class="px-6">
            
            <form id="registrationForm" onsubmit="handleFormSubmit(event)" class="space-y-4">

                <!-- 1단계: 판매희망가 입력 -->
                <div id="step1" class="space-y-6 border border-gray-200 rounded-xl p-6 shadow-lg bg-blue-50">
                    <h2 class="text-xl font-bold text-gray-800 pb-2 mb-4">
                        1단계 : 판매희망가 입력
                    </h2>
                    <hr class="border-t border-gray-300 -mt-2 mb-4">
                    
                    <div class="flex flex-col space-y-2">
                        
                        <label class="block text-xl text-gray-700 font-bold mb-1">면허판매 희망가(차량가격 제외)</label>
                        
                        <div class="flex justify-center">
                            <div class="inline-flex items-center space-x-2 bg-yellow-100 rounded-xl p-3 text-2xl font-bold border border-yellow-300">
                                
                                <span class="text-gray-800 whitespace-nowrap">1억</span>
                                
                                <!-- 4자리 입력 필드 -->
                                <input
                                    type="number"
                                    id="priceInput"
                                    name="price_manwon"
                                    placeholder="숫자입력"
                                    required
                                    min="0"
                                    max="9999"
                                    maxlength="4"
                                    class="input-field !p-2 !bg-transparent text-center flex-1 !shadow-none !border-none"
                                    oninput="checkInputStatus(this); limitDigits(this, 4);"
                                    onfocus="handleFocus(this)"
                                    onblur="handleBlur(this)"
                                    onclick="openModal(this, '희망가 (4자리)')"
                                    style="min-width: 80px; max-width: 120px;"
                                >
                                
                                <span class="text-gray-800 whitespace-nowrap">만원</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 1단계 다음 버튼 (박스 외부 분리 및 스타일 조정) -->
                <button type="button" onclick="goToStep2()" class="w-full h-14 bg-blue-50 text-custom-blue-btn border-2 border-custom-blue-btn text-xl py-3 rounded-xl transition duration-200 shadow-lg font-bold mt-4">
                    2단계로
                </button>

                <!-- 2단계: 연락정보 및 차량번호 입력 -->
                <div id="step2" class="space-y-6 hidden border border-gray-200 rounded-xl p-6 shadow-lg bg-blue-50">
                    <h2 class="text-xl font-bold text-gray-800 pb-2 mb-4">
                        2단계 : 연락정보 및 차량번호 입력
                    </h2>
                    <hr class="border-t border-gray-300 -mt-2 mb-4">

                    <!-- 성함 입력 -->
                    <div class="flex items-center">
                        <label for="userName" class="text-lg text-gray-700 font-bold w-1/4 min-w-[80px]">성함</label>
                        <input
                            type="text"
                            id="userName"
                            name="user_name"
                            placeholder="성함 입력"
                            required
                            class="input-field flex-1 ml-4"
                            oninput="checkInputStatus(this)"
                            onfocus="handleFocus(this)"
                            onblur="handleBlur(this)"
                            onclick="openModal(this, '성함')"
                        >
                    </div>

                    <!-- 전화번호 입력 (010- 고정 및 8자리 입력) -->
                    <div class="flex items-center">
                        <label for="phoneNumber" class="text-lg text-gray-700 font-bold w-1/4 min-w-[80px]">전화번호</label>
                        <div class="flex items-center flex-1 ml-4 space-x-2">
                            
                            <span class="text-xl text-gray-800 font-bold bg-gray-200 rounded-xl px-4 h-14 flex items-center whitespace-nowrap">010 -</span>
                            
                            <input
                                type="tel"
                                id="phoneNumber"
                                name="phone_number_8digits"
                                placeholder="8자리 입력"
                                required
                                pattern="[0-9]{4}-[0-9]{4}" 
                                maxlength="9" 
                                class="input-field flex-1"
                                oninput="checkInputStatus(this); formatPhoneNumber(this)" 
                                onfocus="handleFocus(this)"
                                onblur="handleBlur(this)"
                                onclick="openModal(this, '전화번호 (8자리)')"
                            >
                        </div>
                    </div>

                    <!-- 차량번호 입력 -->
                    <div class="space-y-2 pt-4">
                        <label for="vehicleNum1" class="block text-lg text-gray-700 font-bold">차량번호 입력 <span class="text-sm font-normal text-gray-500">(예시 : 서울30아1234)</span></label>
                        <div class="flex items-center space-x-2">
                            
                            <span class="text-xl text-gray-800 font-bold bg-gray-200 rounded-xl px-4 h-14 flex items-center whitespace-nowrap">서울</span>
                            
                            <!-- 2자리 -->
                            <input
                                type="number"
                                id="vehicleNum1"
                                name="vehicle_num_1"
                                placeholder="2자리"
                                required
                                min="10"
                                max="99"
                                maxlength="2"
                                class="input-field w-[20%] text-center !px-2"
                                oninput="checkInputStatus(this); limitDigits(this, 2);"
                                onfocus="handleFocus(this)"
                                onblur="handleBlur(this)"
                                onclick="openModal(this, '차량번호 (2자리)')"
                            >

                            <!-- 드롭다운 -->
                            <select
                                id="vehicleLetter"
                                name="vehicle_letter"
                                required
                                class="input-field w-[25%] text-center cursor-pointer !px-2"
                                oninput="checkInputStatus(this)"
                                onfocus="handleFocus(this)"
                                onblur="handleBlur(this)"
                                onclick="openModal(this, '차량번호 (용도)')"
                            >
                                <option value="" disabled selected>선택</option>
                                <option value="아">아</option>
                                <option value="바">바</option>
                                <option value="사">사</option>
                                <option value="자">자</option>
                            </select>
                            
                            <!-- 4자리 -->
                            <input
                                type="number"
                                id="vehicleNum2"
                                name="vehicle_num_2"
                                placeholder="4자리"
                                required
                                min="0000"
                                max="9999"
                                maxlength="4"
                                class="input-field flex-1 text-center !px-2"
                                oninput="checkInputStatus(this); limitDigits(this, 4);"
                                onfocus="handleFocus(this)"
                                onblur="handleBlur(this)"
                                onclick="openModal(this, '차량번호 (4자리)')"
                            >
                        </div>
                    </div>

                    <!-- 개인정보 동의 및 이용내역 -->
                    <div class="pt-4 border-t border-gray-200 mt-6 space-y-4">
                        <label class="flex items-center cursor-pointer space-x-3">
                            <input type="checkbox" id="consent" required class="h-6 w-6 text-custom-blue-btn rounded-md border-gray-400 focus:ring-custom-blue-btn">
                            <span class="text-lg text-gray-800 font-bold">
                                개인정보 수집 및 이용에 동의합니다. (필수)
                            </span>
                        </label>
                        
                        <div class="bg-gray-100 p-4 rounded-lg text-sm border border-gray-300 max-h-40 overflow-y-scroll text-gray-600 space-y-2 leading-relaxed">
                            <p class="font-bold text-gray-800">[개인정보수집 및 이용내역]</p>
                            <ol class="list-decimal list-inside space-y-1 pl-2">
                                <li>
                                    <span class="font-semibold">수집 항목:</span> 성함, 전화번호, 차량번호, 면허판매 희망가격
                                </li>
                                <li>
                                    <span class="font-semibold">수집 목적:</span> 택시면허 희망가 도달 알림
                                </li>
                                <li>
                                    <span class="font-semibold">보유 및 이용 기간:</span> 동의 철회 시 또는 수집 목적 달성 시까지
                                </li>
                            </ol>
                            <p class="mt-2">
                                귀하는 개인정보 수집 및 이용에 동의하지 않을 권리가 있으나, 동의하지 않을 경우 서비스 이용이 제한될 수 있습니다.
                            </p>
                            <p class="mt-2 font-bold text-gray-800">주식회사 한국모빌리티연구소 귀중</p>
                        </div>
                    </div>

                    <!-- 버튼 영역 (이전: 회색, 신청하기: 파란색, 크기 비율 조정) -->
                    <div class="flex pt-4">
                        
                        <button type="button" onclick="goToStep1()" class="w-1/3 h-14 bg-gray-200 text-grey-btn-text border-2 border-gray-300 py-3 rounded-xl transition duration-200 hover:bg-gray-300 text-xl font-bold mr-3">
                            이전
                        </button>
                        
                        <button type="submit" class="w-2/3 h-14 bg-custom-blue-btn hover:bg-blue-600 text-white text-xl py-3 rounded-xl transition duration-200 shadow-lg font-bold">
                            신청하기
                        </button>
                    </div>
                </div>

                <!-- 성공 메시지 -->
                <div id="successMessage" class="hidden text-center p-8 bg-green-50 border border-green-300 rounded-lg shadow-inner">
                    <svg class="mx-auto h-12 w-12 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h3 class="mt-2 text-xl font-bold text-gray-900">등록 완료!</h3>
                    <p class="mt-1 text-lg text-gray-500">희망가 도달 시 알림을 보내드리겠습니다. 감사합니다.</p>
                </div>

            </form>
        </main>
    </div>

    <!-- 돋보기(확대 입력) 모달 -->
    <div id="inputModal" class="modal hidden" role="dialog" aria-modal="true">
        <div class="modal-content">
            <h3 id="modalTitle" class="text-2xl font-bold text-gray-800 mb-4"></h3>
            
            <div id="modalInputContainer" class="flex items-center space-x-2">
                <!-- 여기에 복사된 입력 필드가 들어감 -->
            </div>
            <button onclick="closeModal(true)" class="w-full h-14 bg-green-500 hover:bg-green-600 text-white text-xl py-3 rounded-xl transition duration-200 shadow-lg font-bold mt-6">
                입력 완료
            </button>
        </div>
    </div>

    <script>
        // === Google Form 연동 설정 ===
        // 요청하신 Google Form의 POST URL
        const FORM_POST_URL = "https://docs.google.com/forms/u/0/d/e/1FAIpQLSdKRsd3rMQuJ9dGMS4PRTVueYEbkZs5ajfAqO8Gni5RUsUdDw/formResponse"; 
        
        // 요청하신 Google Form의 entry ID
        const ENTRY_ID = {
            NAME: 'entry.404085379',
            PHONE: 'entry.567198169',
            CAR_NUM: 'entry.336296250',
            CONSENT: 'entry.484357262',
            PRICE: 'entry.830537506',
        };

        // 전역 DOM 요소
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const successMessage = document.getElementById('successMessage');
        const form = document.getElementById('registrationForm');
        let activeElement = null; // 현재 모달에서 편집 중인 원본 요소

        // === 입력 필드 상태 관리 함수 ===

        /**
         * 입력 필드의 배경색을 노란색(기본) 또는 흰색(입력 완료)으로 변경
         * @param {HTMLElement} element - 대상 입력 필드
         */
        function checkInputStatus(element) {
            // 값이 비어있지 않고 유효하면 'input-completed' 클래스 추가 (흰색 배경)
            if (element.value.trim() !== '' && element.checkValidity()) {
                element.classList.add('input-completed');
                element.classList.remove('bg-yellow-100');
            } else {
                // 값이 비어있거나 유효하지 않으면 'input-completed' 클래스 제거 (노란색 배경)
                element.classList.remove('input-completed');
                element.classList.add('bg-yellow-100');
            }
        }

        /**
         * 입력 필드 포커스 시 노란색 배경 제거 및 흰색 배경, 파란색 테두리 적용
         * @param {HTMLElement} element - 대상 입력 필드
         */
        function handleFocus(element) {
            element.classList.remove('bg-yellow-100');
            element.classList.add('bg-white');
            element.classList.add('border-blue-500');
        }

        /**
         * 입력 필드 포커스 해제 시 상태 확인
         * @param {HTMLElement} element - 대상 입력 필드
         */
        function handleBlur(element) {
            element.classList.remove('border-blue-500');
            checkInputStatus(element);
        }

        /**
         * 입력 길이 제한 (maxlength 속성 대체)
         * @param {HTMLElement} element - 대상 입력 필드
         * @param {number} limit - 최대 길이
         */
        function limitDigits(element, limit) {
            if (element.value.length > limit) {
                element.value = element.value.slice(0, limit);
            }
        }
        
        /**
         * 전화번호에 자동으로 하이픈(dash)을 삽입하고, 숫자와 하이픈만 허용하며, 길이를 제한합니다.
         * @param {HTMLElement} element - 전화번호 입력 필드
         */
        function formatPhoneNumber(element) {
            let value = element.value.replace(/[^0-9]/g, ''); // 숫자만 남깁니다.
            let formattedValue = '';
            
            // 4자리 후 자동으로 하이픈 삽입
            if (value.length > 4) {
                formattedValue = value.substring(0, 4) + '-' + value.substring(4, 8);
            } else {
                formattedValue = value;
            }
            
            element.value = formattedValue;

            // 길이 제한 (8자리 숫자 + 1개 대시 = 9)
            if (element.value.length > 9) {
                element.value = element.value.slice(0, 9);
            }

             // checkInputStatus를 호출하여 색상 업데이트
            checkInputStatus(element);
        }

        // === 돋보기 (모달) 기능 함수 ===
        
        /**
         * 모달 열기 및 원본 필드 내용 복사
         * @param {HTMLElement} element - 클릭된 원본 입력/선택 요소
         * @param {string} title - 모달 제목
         */
        function openModal(element, title) {
            // 터치 이벤트 발생 시 기본 포커스 동작 방지
            if (event) {
                event.preventDefault();
                element.blur(); 
            }

            activeElement = element;
            document.getElementById('modalTitle').textContent = title;
            const container = document.getElementById('modalInputContainer');
            container.innerHTML = ''; // 기존 내용 삭제

            const modalInput = element.cloneNode(true);
            modalInput.removeAttribute('onclick'); // 무한 루프 방지
            modalInput.removeAttribute('onfocus');
            modalInput.removeAttribute('onblur');
            modalInput.removeAttribute('class'); // 클래스 초기화

            // 모달 내 확대된 스타일 적용
            modalInput.classList.add('w-full', 'h-20', 'text-3xl', 'px-4', 'rounded-xl', 'border-2', 'border-gray-300', 'focus:border-custom-blue-btn', 'focus:ring-0', 'transition', 'duration-200');

            // oninput 이벤트 핸들러를 모달 입력 필드에 맞게 복사하거나 조정
            if (element.id === 'phoneNumber') {
                modalInput.setAttribute('oninput', 'formatPhoneNumber(this)');
            } else if (element.id === 'priceInput' || element.id === 'vehicleNum1' || element.id === 'vehicleNum2') {
                modalInput.setAttribute('oninput', `limitDigits(this, ${element.maxLength})`);
            } else if (element.id === 'userName') {
                modalInput.setAttribute('oninput', 'checkInputStatus(this)');
            }


            // 1단계 입력 필드는 1억과 만원 텍스트가 필요함
            if (element.id === 'priceInput') {
                const wrapper = document.createElement('div');
                wrapper.classList.add('flex', 'items-center', 'space-x-2', 'w-full');
                
                const span1 = document.createElement('span');
                span1.textContent = '1억';
                span1.classList.add('text-3xl', 'font-bold', 'text-gray-800');
                
                const span2 = document.createElement('span');
                span2.textContent = '만원';
                span2.classList.add('text-3xl', 'font-bold', 'text-gray-800');

                modalInput.classList.add('text-center', 'flex-1');
                modalInput.style.minWidth = '80px';
                
                wrapper.appendChild(span1);
                wrapper.appendChild(modalInput);
                wrapper.appendChild(span2);
                container.appendChild(wrapper);

            } else {
                // 일반 입력 필드 (2단계)
                container.appendChild(modalInput);
                if (element.id === 'phoneNumber') {
                    // 전화번호는 010-을 모달에서도 보여줌
                    const prefix = document.createElement('span');
                    prefix.textContent = '010 -';
                    prefix.classList.add('text-3xl', 'font-bold', 'text-gray-800');
                    container.insertBefore(prefix, modalInput);
                } else if (element.id === 'vehicleNum1' || element.id === 'vehicleLetter' || element.id === 'vehicleNum2') {
                    // 차량번호 필드는 '서울', '2자리', '선택', '4자리'가 모달에도 필요
                    const vehicleNum1 = document.getElementById('vehicleNum1');
                    const vehicleLetter = document.getElementById('vehicleLetter');
                    const vehicleNum2 = document.getElementById('vehicleNum2');

                    const wrapper = document.createElement('div');
                    wrapper.classList.add('flex', 'items-center', 'space-x-2', 'w-full');

                    const spanSeoul = document.createElement('span');
                    spanSeoul.textContent = '서울';
                    spanSeoul.classList.add('text-3xl', 'font-bold', 'text-gray-800');
                    wrapper.appendChild(spanSeoul);

                    // 각 필드를 모달에 맞게 복사 (클릭된 요소만 활성화)
                    if (element.id === 'vehicleNum1') {
                        modalInput.classList.add('text-center', 'flex-1');
                        wrapper.appendChild(modalInput);
                        // 나머지 필드는 읽기 전용으로 추가
                        const selectClone = vehicleLetter.cloneNode(true);
                        selectClone.disabled = true;
                        selectClone.classList.add('h-20', 'text-3xl', 'px-4', 'rounded-xl', 'border-2', 'border-gray-300', 'bg-gray-100');
                        const inputClone = vehicleNum2.cloneNode(true);
                        inputClone.readOnly = true;
                        inputClone.classList.add('h-20', 'text-3xl', 'px-4', 'rounded-xl', 'border-2', 'border-gray-300', 'bg-gray-100');
                        wrapper.appendChild(selectClone);
                        wrapper.appendChild(inputClone);
                    } else if (element.id === 'vehicleLetter') {
                        const inputClone1 = vehicleNum1.cloneNode(true);
                        inputClone1.readOnly = true;
                        inputClone1.classList.add('h-20', 'text-3xl', 'px-4', 'rounded-xl', 'border-2', 'border-gray-300', 'bg-gray-100');
                        wrapper.appendChild(inputClone1);
                        wrapper.appendChild(modalInput);
                        const inputClone2 = vehicleNum2.cloneNode(true);
                        inputClone2.readOnly = true;
                        inputClone2.classList.add('h-20', 'text-3xl', 'px-4', 'rounded-xl', 'border-2', 'border-gray-300', 'bg-gray-100');
                        wrapper.appendChild(inputClone2);
                    } else if (element.id === 'vehicleNum2') {
                        const inputClone1 = vehicleNum1.cloneNode(true);
                        inputClone1.readOnly = true;
                        inputClone1.classList.add('h-20', 'text-3xl', 'px-4', 'rounded-xl', 'border-2', 'border-gray-300', 'bg-gray-100');
                        const selectClone = vehicleLetter.cloneNode(true);
                        selectClone.disabled = true;
                        selectClone.classList.add('h-20', 'text-3xl', 'px-4', 'rounded-xl', 'border-2', 'border-gray-300', 'bg-gray-100');
                        wrapper.appendChild(inputClone1);
                        wrapper.appendChild(selectClone);
                        modalInput.classList.add('text-center', 'flex-1');
                        wrapper.appendChild(modalInput);
                    }
                    container.appendChild(wrapper);

                }
            }

            document.getElementById('inputModal').classList.remove('hidden');
            
            // 모달이 열린 후 0.1초 뒤에 입력 필드에 포커스
            setTimeout(() => {
                const inputToFocus = container.querySelector('input:not([readonly]), select:not([disabled])');
                if (inputToFocus) {
                    inputToFocus.focus();
                }
            }, 100);
        }

        /**
         * 모달 닫기 및 내용 원본 필드로 복사
         * @param {boolean} shouldSave - 입력 완료 버튼을 눌렀는지 여부
         */
        function closeModal(shouldSave = false) {
            const modalInput = document.getElementById('modalInputContainer').querySelector('input:not([readonly]), select:not([disabled])');
            
            if (activeElement && modalInput && shouldSave) {
                // 원본 필드에 값 복사
                activeElement.value = modalInput.value;
                // 원본 필드의 상태 업데이트 (색상 변경)
                checkInputStatus(activeElement);
            }
            
            document.getElementById('inputModal').classList.add('hidden');
            activeElement = null;
        }

        // 모달 외부 클릭 시 닫기
        document.getElementById('inputModal').addEventListener('click', function(e) {
            if (e.target.id === 'inputModal') {
                closeModal(false);
            }
        });
        
        // === 단계 이동 및 제출 함수 ===

        /**
         * 1단계에서 2단계로 전환
         */
        function goToStep2() {
            const priceInput = document.getElementById('priceInput');
            
            // 1단계 유효성 검사 (4자리 숫자 확인)
            if (priceInput.value.length !== 4) {
                alert('희망가 4자리를 정확히 입력해주세요.');
                priceInput.focus();
                return;
            }

            // 1단계 숨기기, 2단계 보이기
            step1.classList.add('hidden');
            // 1단계 버튼 숨기기
            step1.nextElementSibling.classList.add('hidden');
            step2.classList.remove('hidden');
            window.scrollTo(0, 0); // 페이지 상단으로 스크롤
        }

        /**
         * 2단계에서 1단계로 전환
         */
        function goToStep1() {
            // 2단계 숨기기, 1단계 보이기
            step2.classList.add('hidden');
            step1.classList.remove('hidden');
            // 1단계 버튼 보이기
            step1.nextElementSibling.classList.remove('hidden');
            window.scrollTo(0, 0); // 페이지 상단으로 스크롤
        }

        // 제출 성공 메시지 표시 함수
        function showSuccess() {
            form.classList.add('hidden');
            successMessage.classList.remove('hidden');
        }

        /**
         * 폼 제출 처리 (Google Form 연동)
         * @param {Event} event - 제출 이벤트 객체
         */
        async function handleFormSubmit(event) {
            event.preventDefault(); // 기본 제출 동작 방지
            
            // 모든 필드에 대해 최종 유효성 검사
            if (!form.checkValidity()) {
                alert('모든 필수 정보를 올바르게 입력했는지 확인해주세요.');
                return;
            }

            console.log("폼 데이터 수집 및 Google Form 전송 준비 중...");
            
            // 데이터 수집
            const priceManwon = document.getElementById('priceInput').value; 
            const totalPrice = 10000 + parseInt(priceManwon, 10); // 1억 + 입력 값
            
            // '010' + 하이픈 제거된 8자리 전화번호
            const rawPhoneNumber = document.getElementById('phoneNumber').value.replace(/-/g, '');
            const fullPhoneNumber = '010' + rawPhoneNumber;
            
            // 차량번호 통합: 서울 + 2자리 + 용도 + 4자리
            const fullCarNum = '서울 ' + 
                                document.getElementById('vehicleNum1').value + 
                                document.getElementById('vehicleLetter').value + 
                                document.getElementById('vehicleNum2').value;

            // 개인정보 동의 상태
            const consentStatus = document.getElementById('consent').checked ? '동의' : '비동의';

            // Google Form 데이터 구성
            const payload = new URLSearchParams({
                [ENTRY_ID.PRICE]: totalPrice.toString(), // 면허 판매 희망가격 (만 원 단위)
                [ENTRY_ID.NAME]: document.getElementById('userName').value, // 성함
                [ENTRY_ID.PHONE]: fullPhoneNumber, // 전화번호 (010 포함)
                [ENTRY_ID.CAR_NUM]: fullCarNum, // 차량번호
                [ENTRY_ID.CONSENT]: consentStatus, // 개인정보 동의
            }).toString();

            // Google Form은 Cross-Origin Request를 허용하지 않으므로, 'no-cors' 모드를 사용합니다.
            try {
                 await fetch(FORM_POST_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: payload
                });
                
                // 성공 처리
                showSuccess();
            } catch (error) {
                // no-cors 모드에서는 오류를 포착하기 어렵지만, 네트워크 오류 등을 대비한 로깅
                console.error('Google Form 제출 중 오류 발생 (네트워크 등 확인 필요):', error);
                // 실제 서비스라면 사용자에게 실패 알림을 표시해야 합니다.
                showSuccess(); // no-cors에서는 성공/실패 여부를 알 수 없어 일단 성공으로 간주하고 UI를 넘김
            }
        }

        // === 초기 설정 ===

        // 초기 로드 시 모든 입력 필드의 상태 확인하여 색상 설정
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.input-field').forEach(input => {
                checkInputStatus(input);
            });
        });

    </script>
</body>
</html>
